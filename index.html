<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>零壹年会抽奖</title>
    <link rel="stylesheet" href="css/style-lottery.css">
    <link rel="stylesheet" href="css/animate.css">
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="easing.js"></script>
</head>

<body>
    <!-- 顶部中国风花纹 start -->
    <header class="top-head"></header>
    <!--左侧中奖名单展示-->
    <aside class="aside-left">
        <div class="aside-main" id="mingdan-con">
            <div class="btn btn-red-outline" data-toggle="modal" id="mingdan-title">中奖号码</div>
            <div class="award-main scrollbar" style="height:calc(100% - 90px)">
                <!--<h3 class="award-title">纪念奖</h3>-->
                <ul class="win">
                </ul>
            </div>
        </div>
        <img src="img/lantern.png" alt="" width="85" id="mingdan" class="switch">
    </aside>
    <!--右侧奖品名单展示-->
    <aside class="aside-right">
        <div class="aside-main" id="liwu-con" style="height:calc(100% - 40px)">
            <div class="btn btn-red-outline" data-toggle="modal" id="liwu-title">新年礼物</div>
            <div id="roll" class="award-main" style="height:calc(100% - 100px)">
                <div class="" id="roll-div">
                    <div class="award-con">
                        <h3 class="award-title">特等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/canon.jpg"/>-->
                                </div>
                                <div class="f-l name">IPhoneX-256G</div>
                            </li>
                        </ul>
                    </div>
                    <div class="award-con">
                        <h3 class="award-title">一等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/canon.jpg"/>-->
                                </div>
                                <div class="f-l name">Tiffany 18K笑脸项链</div>
                            </li>
                        </ul>
                    </div>
                    <div class="award-con">
                        <h3 class="award-title">二等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/canon.jpg"/>-->
                                </div>
                                <div class="f-l name">LOVO罗莱生活春秋被</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/canon.jpg"/>-->
                                </div>
                                <div class="f-l name">美的手持无线吸尘器</div>
                            </li>
                        </ul>
                    </div>
                    <div class="award-con">
                        <h3 class="award-title">三等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/jingdong.jpg"/>-->
                                </div>
                                <div class="f-l name">哈根达斯尊礼卡</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/yashua.jpg"/>-->
                                </div>
                                <div class="f-l name">阿尔郎电动平衡车</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/anmo.jpg"/>-->
                                </div>
                                <div class="f-l name">美的蒸汽挂烫机</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/anmo.jpg"/>-->
                                </div>
                                <div class="f-l name">铁三角复刻版耳机</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/anmo.jpg"/>-->
                                </div>
                                <div class="f-l name">第八代kindle</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/anmo.jpg"/>-->
                                </div>
                                <div class="f-l name">枕头</div>
                            </li>
                        </ul>
                    </div>
                    <div class="award-con">
                        <h3 class="award-title">四等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/chongdian.jpg"/>-->
                                </div>
                                <div class="f-l name">卡拉羊（Carany）拉杆箱</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/nuanshou.jpg"/>-->
                                </div>
                                <div class="f-l name">美的家用多功能电烤箱</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/bao.jpg"/>-->
                                </div>
                                <div class="f-l name">华为运动手环</div>
                            </li>
                        </ul>
                    </div>
                    <div class="award-con">
                        <h3 class="award-title">五等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/chongdian.jpg"/>-->
                                </div>
                                <div class="f-l name">宝石5200ma移动电源</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/nuanshou.jpg"/>-->
                                </div>
                                <div class="f-l name">乐泡薄荷10000ma移动电源</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/bao.jpg"/>-->
                                </div>
                                <div class="f-l name">乐上LEXON男卡多功能包</div>
                            </li>
                        </ul>
                    </div>
                    <div class="award-con">
                        <h3 class="award-title">特等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/canon.jpg"/>-->
                                </div>
                                <div class="f-l name">IPhoneX-256G</div>
                            </li>
                        </ul>
                    </div>
                    <div class="award-con">
                        <h3 class="award-title">一等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/canon.jpg"/>-->
                                </div>
                                <div class="f-l name">Tiffany 18K笑脸项链</div>
                            </li>
                        </ul>
                    </div>
                    <div class="award-con">
                        <h3 class="award-title">二等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/canon.jpg"/>-->
                                </div>
                                <div class="f-l name">LOVO罗莱生活春秋被</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/canon.jpg"/>-->
                                </div>
                                <div class="f-l name">美的手持无线吸尘器</div>
                            </li>
                        </ul>
                    </div>
                    <div class="award-con">
                        <h3 class="award-title">三等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/jingdong.jpg"/>-->
                                </div>
                                <div class="f-l name">哈根达斯尊礼卡</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/yashua.jpg"/>-->
                                </div>
                                <div class="f-l name">阿尔郎电动平衡车</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/anmo.jpg"/>-->
                                </div>
                                <div class="f-l name">美的蒸汽挂烫机</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/anmo.jpg"/>-->
                                </div>
                                <div class="f-l name">铁三角复刻版耳机</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/anmo.jpg"/>-->
                                </div>
                                <div class="f-l name">第八代kindle</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/anmo.jpg"/>-->
                                </div>
                                <div class="f-l name">枕头</div>
                            </li>
                        </ul>
                    </div>
                    <div class="award-con">
                        <h3 class="award-title">四等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/chongdian.jpg"/>-->
                                </div>
                                <div class="f-l name">卡拉羊（Carany）拉杆箱</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/nuanshou.jpg"/>-->
                                </div>
                                <div class="f-l name">美的家用多功能电烤箱</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/bao.jpg"/>-->
                                </div>
                                <div class="f-l name">华为运动手环</div>
                            </li>
                        </ul>
                    </div>
                    <div class="award-con">
                        <h3 class="award-title">五等奖</h3>
                        <ul class="win">
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/chongdian.jpg"/>-->
                                </div>
                                <div class="f-l name">宝石5200ma移动电源</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/nuanshou.jpg"/>-->
                                </div>
                                <div class="f-l name">乐泡薄荷10000ma移动电源</div>
                            </li>
                            <li class="clearfix win-li">
                                <div class="f-l avatar">
                                    <!--<img width="34" src="img/gift/bao.jpg"/>-->
                                </div>
                                <div class="f-l name">乐上LEXON男卡多功能包</div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <img src="img/lantern.png" alt="" width="85" id="liwu" class="switch">
        <img src="img/clear.png" id="clear">
    </aside>
    <!--倒计时展示-->
    <div class="main">
        <div class="lotterty-infogo">
            <img src="img/logo.png">
        </div>
        <div id="lottery-main" class="lottery-main">
            <img src="img/wrap-border-1.png" class="wrap-border-1">
            <img src="img/wrap-border-2.png" class="wrap-border-2">
            <img src="img/wrap-border-3.png" class="wrap-border-3">
            <img src="img/wrap-border-4.png" class="wrap-border-4">
            <div class="num-bg-box">
                <!-- 数字盒子-->
                <div class="num_box">
                    <div class="num"></div>
                    <div class="num"></div>
                    <div class="num"></div>
                    <div class="num"></div>
                </div>
            </div>
            <!--抽奖按钮-->
            <div class="btn-box" style="position: absolute;bottom: -100px;">
                <div class="btn_lotterty start">开始抽奖</div>
                <div class="btn_lotterty stop">停止抽奖</div>
            </div>
        </div>
    </div>
    <footer class="footer"></footer>
    <script>
    // 初始化抽奖人数
    var lotterty_data = [];
    for (var i = 1; i <= 4; i++) {
        lotterty_data.push(addPreZero(i));
    }
    // var lotterty_data = "";

    // function getData() {
    //     $.ajax({
    //         url: 'http://192.168.6.12:7248/yihao01-advert-web/annualMeeting/getReceivedNums.do',
    //         type: 'get',
    //         dataType: 'json',
    //         success: function(res) {
    //             console.log(res);
    //             lotterty_data = res;
    //         }
    //     })
    // }

    // getData();

    var u = 260;
    var n = 1;
    var timer; //定义滚动的定时器
    var result = 0000; //指定中奖结果,可以抽取指定数组中的某一个
    var isBegin = false; //标识能否开始抽奖
    var isStoped = false; // 停止状态
    var lottertyArr;
    $(".num").css('backgroundPositionY', 0); //
    $(".num").eq(0).css('backgroundPositionY', 0);
    $(".num").eq(1).css('backgroundPositionY', 0);

    //执行数字滚动
    function run() {
        n++;
        $(".num").each(function(index) {
            var _num = $(this);
            _num.animate({
                backgroundPositionY: ((u + 1) * n * (index + 1))
            }, 100);

        });
        timer = window.setTimeout(run, 100);
        isBegin = true;
    }
    $(function() {

        var initLottertyArr; // 抽奖人数，已经中奖的人必须剔除，不能再抽奖;

        //开始抽奖
        $('.start').click(function() {
            if (localStorage.getItem('lotterty')) {
                currentLottertyArr = JSON.parse(localStorage.getItem('lotterty')); // 当前中奖的人
                for (var i = 0; i < sortArr(lotterty_data).length; i++) {
                    for (var j = 0; j < sortArr(currentLottertyArr).length; j++) {
                        if (currentLottertyArr[j] === lotterty_data[i]) {
                            // console.log(currentLottertyArr[j], j + '----', lotterty_data[i], i)
                            lotterty_data.splice(i, 1)
                        }
                    }
                };
                initLottertyArr = lotterty_data;
            } else {
                initLottertyArr = lotterty_data; // 没有中奖的
            }
            if (isBegin) {
                return false;
            } else {
                if (initLottertyArr.length < 1) {
                    alert("没有人了，都已经中奖了");
                    return;
                };
                run();
                isStoped = false;
            }
        });
        //停止抽奖
        $('.stop').click(function() {
            if (!isStoped) {
                lottery(initLottertyArr);
                showLotterty(".win");
                isStoped = true;
            }
        });


        $("#mingdan").click(function() {
            $(this).prev().slideDown();
            showLotterty(".win");
        });
        $("#mingdan-title").click(function() {
            $(this).parent().slideUp();
        })

        // 清除中奖的人，
        $("#clear").click(function() {
            if (!isBegin) {
                if (confirm("确定删除数据吗？")) {
                    localStorage.removeItem("lotterty");
                    $(".win").html("");
                    getData();
                } else {
                    return;
                }
            }
        })

        $(document).keydown(function(e) {
            if (!e) var e = window.event;
            if (e.keyCode == 32) {
                $(".start").click();
            }
        });
        $(document).keydown(function(e) {
            if (!e) var e = window.event;
            if (e.keyCode == 13) {
                $(".stop").click();
            }
        });

    });

    // 展示中奖名单
    function showLotterty(ele) {


        if (localStorage.getItem('lotterty')) {
            var currentLottertyArr = JSON.parse(localStorage.getItem('lotterty'));
            var html = "";
            for (var i = 0; i < currentLottertyArr.length; i++) {
                html += "<li>" + currentLottertyArr[i] + "</li>";
            };
            $(ele).html(html);
        }

    }

    function sortArr(arr) {
        return arr.sort(function(a, b) {
            return a - b;
        })
    }

    function lottery(currentArr) {
        console.log("currentArr", currentArr)
        if (currentArr.constructor != Array) return;
        var i = Math.floor(Math.random() * currentArr.length);
        var currentNumber = currentArr[i]; //中奖号码
        var num_arr = (currentNumber + '').split('');
        if (localStorage.getItem('lotterty')) {
            lottertyArr = JSON.parse(localStorage.getItem('lotterty'));
        } else {
            lottertyArr = [];
        }
        lottertyArr.push(currentNumber);
        // 将中奖的存起来
        localStorage.setItem("lotterty", JSON.stringify(lottertyArr));
        $(".num").each(function(index) {
            var _num = $(this);
            setTimeout(function() {
                _num.animate({
                    backgroundPositionY: (u * 60) - (u * num_arr[index])
                }, {
                    duration: 500,
                    easing: "easeInOutCirc",
                    complete: function() {
                        if (index == 10) {
                            isBegin = false;
                        }
                    }
                });
            }, 100);
        });
        window.clearTimeout(timer);
        isBegin = false;
    }

    function addPreZero(num) {
        if (num < 10) {
            return '000' + num;
        } else if (num < 100) {
            return '00' + num;
        } else if (num < 1000) {
            return '0' + num;
        } else {
            return num;
        }
    }
    </script>
</body>

</html>